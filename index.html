<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دانلود آخرین نسخه v2rayNG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .countdown {
            font-size: 1.2rem;
            color: #dc3545;
            font-weight: bold;
        }
        .release-notes {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-line;
        }
        .spinner-border {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title text-center">آخرین نسخه v2rayNG</h3>
                    </div>
                    <div class="card-body" id="content">
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">در حال دریافت اطلاعات...</span>
                            </div>
                            <p>در حال دریافت اطلاعات از GitHub...</p>
                        </div>
                    </div>
                    <div class="card-footer text-muted text-center">
                      <small> نوشته شده توسط : <a href="https://t.me/dvhost_cloud">DVHOST.CLOUD</a> </small> <br>
                        <small>این صفحه آخرین نسخه را از <a href="https://github.com/2dust/v2rayNG/releases" target="_blank">صفحه ریلیزهای GitHub</a> دریافت میکند.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // تابع برای دریافت اطلاعات ریلیزها
        async function fetchReleases() {
            try {
                const response = await fetch('https://api.github.com/repos/2dust/v2rayNG/releases');
                if (!response.ok) {
                    throw new Error('خطا در دریافت اطلاعات از GitHub');
                }
                const releases = await response.json();
                
                if (!releases || releases.length === 0) {
                    throw new Error('هیچ ریلیزی یافت نشد');
                }
                
                const latestRelease = releases[0];
                const latestVersion = latestRelease.tag_name;
                const releaseNotes = latestRelease.body;
                
                // یافتن لینک دانلود universal
                let universalDownloadUrl = '';
                if (latestRelease.assets) {
                    const universalAsset = latestRelease.assets.find(asset => 
                        asset.name.includes('universal.apk')
                    );
                    if (universalAsset) {
                        universalDownloadUrl = universalAsset.browser_download_url;
                    }
                }
                
                // نمایش اطلاعات
                renderReleaseInfo(latestVersion, universalDownloadUrl, releaseNotes);
                
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="alert alert-danger">
                        ${error.message}
                    </div>
                `;
            }
        }
        
        // تابع برای نمایش اطلاعات ریلیز
        function renderReleaseInfo(version, downloadUrl, notes) {
            let content = '';
            
            if (version) {
                content += `
                    <div class="alert alert-success text-center">
                        <h4>نسخه ${version}</h4>
                    </div>
                `;
                
                if (downloadUrl) {
                    content += `
                        <div class="text-center mb-4">
                            <a href="${downloadUrl}" class="btn btn-success btn-lg" id="downloadBtn">
                                دانلود نسخه یونیورسال
                            </a>
                        </div>
                        
                        <div class="text-center countdown">
                            دانلود به صورت خودکار در <span id="countdown">10</span> ثانیه
                        </div>
                    `;
                } else {
                    content += `
                        <div class="alert alert-warning">
                            نسخه یونیورسال در این ریلیز یافت نشد.
                        </div>
                    `;
                }
                
                if (notes) {
                    content += `
                        <div class="mt-4">
                            <h5>توضیحات نسخه:</h5>
                            <div class="release-notes">${notes}</div>
                        </div>
                    `;
                }
            } else {
                content = `
                    <div class="alert alert-danger">
                        خطا در دریافت اطلاعات از GitHub. لطفاً دوباره تلاش کنید.
                    </div>
                `;
            }
            
            document.getElementById('content').innerHTML = content;
            
            // فعال کردن دانلود خودکار اگر لینک دانلود وجود دارد
            if (downloadUrl) {
                startCountdown(downloadUrl);
            }
        }
        
        // تابع برای شروع تایمر دانلود خودکار
        function startCountdown(downloadUrl) {
            let seconds = 10;
            const countdownElement = document.getElementById('countdown');
            const downloadBtn = document.getElementById('downloadBtn');
            
            const countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = downloadUrl;
                }
            }, 1000);
            
            // امکان توقف تایمر با کلیک روی دکمه
            downloadBtn.addEventListener('click', (e) => {
                e.preventDefault();
                clearInterval(countdownInterval);
                countdownElement.textContent = '0';
                window.location.href = downloadUrl;
            });
        }
        
        // شروع فرآیند هنگام لود صفحه
        document.addEventListener('DOMContentLoaded', fetchReleases);
    </script>
</body>
</html>